name: Build ESPHome Firmware

on:
  issues:
    types: [opened, edited]

jobs:
  build:
    if: contains(github.event.issue.labels.*.name, 'ESPHome')
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: 3.x

    - name: Install ESPHome
      run: |
        python -m pip install esphome

    - name: Parse issue form
      id: parse_form
      uses: onmax/issue-form-parser@v1.5
      with:
        issue_number: ${{ github.event.issue.number }}
        github_token: ${{ secrets.GITHUB_TOKEN }}

  # Examples on how to use the output
  - name: Show parsed payload data
    run: |
      echo '${{ steps.parse.outputs.payload }}'
      echo '${{ fromJson(steps.parse.outputs.payload)["Static_IP"] }}'
